<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Extended Key Update for Transport Layer Security (TLS) 1.3</title>
<meta content="Hannes Tschofenig" name="author">
<meta content="Michael TÃ¼xen" name="author">
<meta content="Tirumaleswar Reddy" name="author">
<meta content="Steffen Fries" name="author">
<meta content="Yaroslav Rosomakho" name="author">
<meta content="
       TLS 1.3 ensures forward secrecy by performing an ephemeral Diffie-Hellman key exchange
during the initial handshake, protecting past communications even if a party's
long-term keys are later compromised. While the built-in KeyUpdate mechanism allows
application traffic keys to be refreshed during a session, it does not incorporate
fresh entropy from a new key exchange and therefore does not provide post-compromise security.
This limitation can pose a security risk in long-lived sessions, such as
those found in industrial IoT or telecommunications environments. 
       To address this, this specification defines an extended key update mechanism that
performs a fresh Diffie-Hellman exchange within an active session, thereby
ensuring post-compromise security. By forcing attackers
to exfiltrate new key material repeatedly, this approach mitigates the risks
associated with static key compromise. Regular renewal of session keys helps
contain the impact of such compromises. The extension is applicable to both TLS 1.3
and DTLS 1.3. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-tls-extended-key-update-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.5.0
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="draft-ietf-tls-extended-key-update.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "â";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Extended Key Update for TLS</td>
<td class="right">October 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tschofenig, et al.</td>
<td class="center">Expires 22 April 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Transport Layer Security</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-tls-extended-key-update-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-10-19" class="published">19 October 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-04-22">22 April 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">H. Tschofenig</div>
<div class="org">Siemens</div>
</div>
<div class="author">
      <div class="author-name">M. TÃ¼xen</div>
<div class="org">MÃ¼nster Univ. of Applied Sciences</div>
</div>
<div class="author">
      <div class="author-name">T. Reddy</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Fries</div>
<div class="org">Siemens</div>
</div>
<div class="author">
      <div class="author-name">Y. Rosomakho</div>
<div class="org">Zscaler</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Extended Key Update for Transport Layer Security (TLS) 1.3</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">TLS 1.3 ensures forward secrecy by performing an ephemeral Diffie-Hellman key exchange
during the initial handshake, protecting past communications even if a party's
long-term keys are later compromised. While the built-in KeyUpdate mechanism allows
application traffic keys to be refreshed during a session, it does not incorporate
fresh entropy from a new key exchange and therefore does not provide post-compromise security.
This limitation can pose a security risk in long-lived sessions, such as
those found in industrial IoT or telecommunications environments.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
<p id="section-abstract-2">To address this, this specification defines an extended key update mechanism that
performs a fresh Diffie-Hellman exchange within an active session, thereby
ensuring post-compromise security. By forcing attackers
to exfiltrate new key material repeatedly, this approach mitigates the risks
associated with static key compromise. Regular renewal of session keys helps
contain the impact of such compromises. The extension is applicable to both TLS 1.3
and DTLS 1.3.<a href="#section-abstract-2" class="pilcrow">Â¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">Â¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Transport Layer Security Working Group mailing list (tls@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/tls/">https://mailarchive.ietf.org/arch/browse/tls/</a></span>.<a href="#section-note.1-2" class="pilcrow">Â¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/hannestschofenig/tls-key-update">https://github.com/hannestschofenig/tls-key-update</a></span>.<a href="#section-note.1-3" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 April 2026.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.Â Â <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.Â Â <a href="#name-terminology-and-requirement" class="internal xref">Terminology and Requirements Language</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.Â Â <a href="#name-negotiating-the-extended-ke" class="internal xref">Negotiating the Extended Key Update</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.Â Â <a href="#name-extended-key-update-message" class="internal xref">Extended Key Update Messages</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.Â Â <a href="#name-tls-13-considerations" class="internal xref">TLS 1.3 Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.Â Â <a href="#name-tls-13-extended-key-update-" class="internal xref">TLS 1.3 Extended Key Update Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.Â Â <a href="#name-dtls-13-considerations" class="internal xref">DTLS 1.3 Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.Â Â <a href="#name-dtls-13-extended-key-update" class="internal xref">DTLS 1.3 Extended Key Update Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.Â Â <a href="#name-updating-traffic-secrets" class="internal xref">Updating Traffic Secrets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.Â Â <a href="#name-post-quantum-cryptography-c" class="internal xref">Post-Quantum Cryptography Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.Â Â <a href="#name-sslkeylogfile-update" class="internal xref">SSLKEYLOGFILE Update</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>.Â <a href="#name-exporter" class="internal xref">Exporter</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>.Â <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.Â Â <a href="#name-post-compromise-security" class="internal xref">Post-Compromise Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.Â Â <a href="#name-denial-of-service-dos" class="internal xref">Denial-of-Service (DoS)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="auto internal xref">11.3</a>.Â Â <a href="#name-operational-guidance" class="internal xref">Operational Guidance</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>.Â <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.Â Â <a href="#name-tls-flags" class="internal xref">TLS Flags</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.Â Â <a href="#name-tls-handshaketype" class="internal xref">TLS HandshakeType</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-12.3" class="auto internal xref">12.3</a>.Â Â <a href="#name-extendedkeyupdate-message-s" class="internal xref">ExtendedKeyUpdate Message Subtypes Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-12.4" class="auto internal xref">12.4</a>.Â Â <a href="#name-sslkeylogfile-labels" class="internal xref">SSLKEYLOGFILE labels</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>.Â <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.Â Â <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.Â Â <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.Â Â <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.Â Â <a href="#name-state-machines" class="internal xref">State Machines</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.Â Â <a href="#name-tls-13-state-machines" class="internal xref">TLS 1.3 State Machines</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.Â Â <a href="#name-initiator-state-machine" class="internal xref">Initiator State Machine</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.3">
                <p id="section-toc.1-1.15.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.Â Â <a href="#name-responder-state-machine" class="internal xref">Responder State Machine</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.4">
                <p id="section-toc.1-1.15.2.4.1"><a href="#appendix-B.4" class="auto internal xref">B.4</a>.Â Â <a href="#name-dtls-13-state-machines" class="internal xref">DTLS 1.3 State Machines</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.4.2.1">
                    <p id="section-toc.1-1.15.2.4.2.1.1"><a href="#appendix-B.4.1" class="auto internal xref">B.4.1</a>.Â Â <a href="#name-terms-and-abbreviations" class="internal xref">Terms and Abbreviations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.4.2.2">
                    <p id="section-toc.1-1.15.2.4.2.2.1"><a href="#appendix-B.4.2" class="auto internal xref">B.4.2</a>.Â Â <a href="#name-state-machine-initiator" class="internal xref">State Machine (Initiator)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.4.2.3">
                    <p id="section-toc.1-1.15.2.4.2.3.1"><a href="#appendix-B.4.3" class="auto internal xref">B.4.3</a>.Â Â <a href="#name-state-machine-responder" class="internal xref">State Machine (Responder)</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Transport Layer Security (TLS) 1.3 protocol provides forward secrecy by using
an ephemeral Diffie-Hellman (DHE) key exchange during the initial handshake. This
ensures that encrypted communication remains confidential even if an attacker
later obtains a party's long-term private key, protecting against passive adversaries
who record encrypted traffic for later decryption.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">TLS 1.3 also includes a KeyUpdate mechanism that allows traffic keys to be refreshed
during an established session. However, this mechanism does not provide
post-compromise security, as it applies only a key derivation function to the
previous application traffic secret as input. While this design is generally sufficient
for short-lived connections, it may present security limitations in scenarios where
sessions persist for extended periods, such as in industrial IoT or telecommunications
systems, where continuous availability is critical and session renegotiation or resumption
is impractical.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">Earlier versions of TLS supported session renegotiation, which allowed peers to negotiate
fresh keying material, including performing new Diffie-Hellman exchanges during the
session lifetime. Due to protocol complexity and known vulnerabilities, renegotiation
was first restricted by <span>[<a href="#TLS-RENEGOTIATION" class="cite xref">TLS-RENEGOTIATION</a>]</span> and ultimately removed in TLS 1.3. While the
KeyUpdate message was introduced to offer limited rekeying functionality, it does
not fulfill the same cryptographic role as renegotiation and cannot refresh
long-term secrets or derive new secrets from fresh DHE input.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">Security guidance from national agencies, such as ANSSI (France <span>[<a href="#ANSSI" class="cite xref">ANSSI</a>]</span>), recommends the
periodic renewal of cryptographic keys during long-lived sessions to limit the
impact of key compromise. This approach encourages designs that force an
attacker to perform dynamic key exfiltration, as defined in <span>[<a href="#CONFIDENTIALITY" class="cite xref">CONFIDENTIALITY</a>]</span>. Dynamic
key exfiltration refers to attack scenarios where an adversary must repeatedly
extract fresh keying material to maintain access to protected data, increasing
operational cost and risk for the attacker. In contrast, static key exfiltration,
where a long-term secret is extracted once and reused, poses a greater long-term
threat, especially when session keys are not refreshed with fresh key exchange input
rather than key derivation.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
<p id="section-1-5">This specification defines a TLS extension that introduces an extended key update
mechanism. Unlike the standard key update, this mechanism allows peers to perform a
fresh Diffie-Hellman exchange within an active session using one of the groups
negotiated during the initial handshake. By periodically rerunning (EC)DHE, this
extension enables the derivation of new traffic secrets that are independent of
prior key material. As noted in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#appendix-F" class="relref">Appendix F</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>, this
approach mitigates the risk of static key exfiltration and shifts the attacker
burden toward dynamic key exfiltration.<a href="#section-1-5" class="pilcrow">Â¶</a></p>
<p id="section-1-6">The proposed extension is applicable to both TLS 1.3 <span>[<a href="#TLS" class="cite xref">TLS</a>]</span> and DTLS 1.3  <span>[<a href="#DTLS" class="cite xref">DTLS</a>]</span>. For clarity,
the term "TLS" is used throughout this document to refer to both protocols unless
otherwise specified.<a href="#section-1-6" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="terminology-and-requirements-language">
<section id="section-2">
      <h2 id="name-terminology-and-requirement">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology-and-requirement" class="section-name selfRef">Terminology and Requirements Language</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCPÂ 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">To distinguish the key update procedure defined in <span>[<a href="#TLS" class="cite xref">TLS</a>]</span>
from the key update procedure specified in this document, we use the terms
"standard key update" and "extended key update", respectively.<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<p id="section-2-3">In this document, we use the term post-compromise security, as defined in
<span>[<a href="#CCG16" class="cite xref">CCG16</a>]</span>. We assume that an adversary may obtain
access to the application traffic secrets but is unable to compromise the
long-term secret.<a href="#section-2-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="negotiating-the-extended-key-update">
<section id="section-3">
      <h2 id="name-negotiating-the-extended-ke">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-negotiating-the-extended-ke" class="section-name selfRef">Negotiating the Extended Key Update</a>
      </h2>
<p id="section-3-1">Client and servers use the TLS flags extension
<span>[<a href="#TLS-FLAGS" class="cite xref">TLS-FLAGS</a>]</span> to indicate support for the functionality
defined in this document.  We call this flag "Extended_Key_Update"
flag.<a href="#section-3-1" class="pilcrow">Â¶</a></p>
<p id="section-3-2">The "Extended_Key_Update" flag proposed by the client in the
ClientHello (CH) <span class="bcp14">MUST</span> be acknowledged in the EncryptedExtensions
(EE), if the server also supports the functionality defined in this
document and is configured to use it.<a href="#section-3-2" class="pilcrow">Â¶</a></p>
<p id="section-3-3">If the "Extended_Key_Update" flag is not set, servers ignore any of the
functionality specified in this document and applications that
require post-compromise security will have to initiate a full
handshake.<a href="#section-3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ext-key-update">
<section id="section-4">
      <h2 id="name-extended-key-update-message">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-extended-key-update-message" class="section-name selfRef">Extended Key Update Messages</a>
      </h2>
<p id="section-4-1">If the client and server agree to use the extended key update mechanism,
the standard key update <span class="bcp14">MUST NOT</span> be used. In this case, the extended key
update fully replaces the standard key update functionality.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<p id="section-4-2">Implementations that receive a classic <code>KeyUpdate</code> message after
successfully negotiating the Extended Key Update functionality <span class="bcp14">MUST</span>
terminate the connection with an <code>"unexpected_message"</code> alert.<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<p id="section-4-3">The extended key update messages are signaled in a new handshake message named
<code>ExtendedKeyUpdate</code> (EKU), with an internal uint8 message subtype indicating its role.
This specification defines three ExtendedKeyUpdate message subtypes:<a href="#section-4-3" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1"><code>key_update_request</code> (0)<a href="#section-4-4.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1"><code>key_update_response</code> (1)<a href="#section-4-4.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1"><code>new_key_update</code> (2)<a href="#section-4-4.3.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-4-5">New ExtendedKeyUpdate message subtypes are assigned by IANA as described in <a href="#iana-eku-registry" class="auto internal xref">Section 12.3</a>.<a href="#section-4-5" class="pilcrow">Â¶</a></p>
<p id="section-4-6">A TLS peer which receives a ExtendedKeyUpdate with an unexpected message subtype <span class="bcp14">MUST</span>
abort the connection with an <code>"unexpected_message"</code> alert.<a href="#section-4-6" class="pilcrow">Â¶</a></p>
<p id="section-4-7">The extended key update process can be initiated by either peer after it has
sent a <code>Finished</code> message. Implementations that receive an <code>ExtendedKeyUpdate</code>
message prior to the sender having sent <code>Finished</code> <span class="bcp14">MUST</span> terminate the connection with
an <code>"unexpected_message"</code> alert.<a href="#section-4-7" class="pilcrow">Â¶</a></p>
<p id="section-4-8">The <code>KeyShareEntry</code> carried in a <code>key_update_request</code> and in
a <code>key_update_response</code> <span class="bcp14">MUST</span> use the group that was negotiated by the client
and server during the initial handshake. An implementation that receives an
algorithm other than previously negotiated <span class="bcp14">MUST</span> terminate the connection
with an <code>"illegal_parameter"</code> alert.<a href="#section-4-8" class="pilcrow">Â¶</a></p>
<p id="section-4-9"><a href="#fig-key-update" class="auto internal xref">Figure 1</a> shows the interaction graphically. First, support
for the functionality in this specification is negotiated in the
<code>ClientHello</code> and the <code>EncryptedExtensions</code> messages. Then, the
<code>ExtendedKeyUpdate</code> exchange is sent to update the application traffic
secrets.<a href="#section-4-9" class="pilcrow">Â¶</a></p>
<p id="section-4-10">The extended key update exchange is performed between the initiator
and the responder; either the TLS client or the TLS server may act
as initiator.<a href="#section-4-10" class="pilcrow">Â¶</a></p>
<span id="name-extended-key-update-message-"></span><div id="fig-key-update">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-4-11.1">
<pre>
       Client                                           Server

Key  ^ ClientHello
Exch | + key_share
     | + signature_algorithms
     v + extended_key_update   --------&gt;
                                                  ServerHello  ^ Key
                                                  + key_share  | Exch
                                                               v
                                        {EncryptedExtensions   ^ Server
                                       + extended_key_update}  | Params
                                         {CertificateRequest}  v
                                                {Certificate}  ^
                                          {CertificateVerify}  | Auth
                                                   {Finished}  v
                               &lt;--------
     ^ {Certificate}
Auth | {CertificateVerify}
     v {Finished}              --------&gt;
       [Application Data]N     &lt;-------&gt;  [Application Data]N
                                  ...
  [EKU(key_update_request)]N   --------&gt;
                               &lt;--------  [EKU(key_update_response)]N
      [EKU(new_key_update)]N   --------&gt;
                               &lt;--------  [EKU(new_key_update)]N
                                  ...
       [Application Data]N+1   &lt;-------&gt;  [Application Data]N+1

Legend:

    +   Indicates noteworthy extensions sent in the
    previously noted message.

    -   Indicates optional or situation-dependent
    messages/extensions that are not always sent.

    () Indicates messages protected using keys
    derived from a client_early_traffic_secret.

    {} Indicates messages protected using keys
    derived from a [sender]_handshake_traffic_secret.

    []N Indicates messages protected using keys
    derived from [sender]_application_traffic_secret_N.
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-extended-key-update-message-" class="selfRef">Extended Key Update Message Exchange in TLS 1.3.</a>
        </figcaption></figure>
</div>
<p id="section-4-12">The <code>ExtendedKeyUpdate</code> wire format is:<a href="#section-4-12" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-13">
<pre>
enum {
   key_update_request(0),
   key_update_response(1),
   new_key_update(2),
   (255)
} ExtendedKeyUpdateType;

struct {
   ExtendedKeyUpdateType eku_type;
   select (eku_type) {
      case key_update_request: {
          KeyShareEntry key_share;
      }
      case key_update_response: {
          KeyShareEntry key_share;
      }
      case new_key_update: {
          /* empty */
      }
   };
} ExtendedKeyUpdate;
</pre><a href="#section-4-13" class="pilcrow">Â¶</a>
</div>
<p id="section-4-14">Fields:<a href="#section-4-14" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-15.1">
          <p id="section-4-15.1.1"><code>eku_type</code>: the subtype of the <code>ExtendedKeyUpdate</code> message.<a href="#section-4-15.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-4-15.2">
          <p id="section-4-15.2.1"><code>key_share</code>: key share information. The contents of this field is
determined by the specified group and its corresponding definition
(see <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#section-4.2.8" class="relref">Section 4.2.8</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>).<a href="#section-4-15.2.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="tls-13-considerations">
<section id="section-5">
      <h2 id="name-tls-13-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-tls-13-considerations" class="section-name selfRef">TLS 1.3 Considerations</a>
      </h2>
<p id="section-5-1">The following steps are taken by a TLS 1.3 implementation; the steps
executed with DTLS 1.3 differ slightly.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">
          <p id="section-5-2.1.1">The initiator sends <code>ExtendedKeyUpdate(key_update_request)</code> carrying a
<code>KeyShareEntry</code>. While an extended key update is in progress, the
initiator <span class="bcp14">MUST NOT</span> initiate another key update.<a href="#section-5-2.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-5-2.2">
          <p id="section-5-2.2.1">Upon receipt, the responder sends its own <code>KeyShareEntry</code> in a
<code>ExtendedKeyUpdate(key_update_response)</code> message. While an extended
key update is in progress, the responder <span class="bcp14">MUST NOT</span> initiate another
key update. The responder <span class="bcp14">MAY</span> defer sending a response if system load or resource
constraints prevent immediate processing. In such cases, the response <span class="bcp14">MUST</span>
be sent once sufficient resources become available.<a href="#section-5-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-5-2.3">
          <p id="section-5-2.3.1">Upon receipt of an <code>ExtendedKeyUpdate(key_update_response)</code> the initiator
derives the new secrets from the exchanged key shares. The initiator then sends an empty
ExtendedKeyUpdate(new_key_update) message to trigger the switch to the
new keys.<a href="#section-5-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-5-2.4">
          <p id="section-5-2.4.1">After the initiator sends <code>ExtendedKeyUpdate(new_key_update)</code> it
<span class="bcp14">MUST</span> update its send keys. Upon receipt of this message, the responder
<span class="bcp14">MUST</span> update its receive keys and then send
<code>ExtendedKeyUpdate(new_key_update)</code>, after which it <span class="bcp14">MUST</span> update its
send keys.<a href="#section-5-2.4.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-5-2.5">
          <p id="section-5-2.5.1">After receiving the responderâs <code>ExtendedKeyUpdate(new_key_update)</code>,
the initiator <span class="bcp14">MUST</span> update its receive keys.<a href="#section-5-2.5.1" class="pilcrow">Â¶</a></p>
</li>
      </ol>
<p id="section-5-3">Both sender and receiver <span class="bcp14">MUST</span> encrypt their
<code>ExtendedKeyUpdate(new_key_update)</code> messages with the old keys. Both
sides <span class="bcp14">MUST</span> ensure that the <code>new_key_update</code> encrypted with the old key
is received before accepting any messages encrypted with the new key.<a href="#section-5-3" class="pilcrow">Â¶</a></p>
<p id="section-5-4">If TLS peers independently initiate the extended key update and the
requests cross in flight, the <code>ExtendedKeyUpdate(key_update_request)</code> with the
lower lexicographic order of the <code>key_exchange</code> value in
<code>KeyShareEntry</code> <span class="bcp14">MUST</span> be ignored. This prevents each
side from advancing keys by two generations. If the tie-break comparison yields
equality (an event that should be impossible for genuine
asymmetric key pairs), the endpoint <span class="bcp14">MUST</span> treat this as a protocol violation,
send an "unexpected_message" alert, and close the connection.<a href="#section-5-4" class="pilcrow">Â¶</a></p>
<p id="section-5-5">The handshake framing uses a single <code>HandshakeType</code> for this message
(see <a href="#fig-handshake" class="auto internal xref">Figure 2</a>).<a href="#section-5-5" class="pilcrow">Â¶</a></p>
<span id="name-tls-13-handshake-structure"></span><div id="fig-handshake">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-5-6.1">
<pre>
      struct {
          HandshakeType msg_type;    /* handshake type */
          uint24 length;             /* bytes in message */
          select (Handshake.msg_type) {
              case client_hello:          ClientHello;
              case server_hello:          ServerHello;
              case end_of_early_data:     EndOfEarlyData;
              case encrypted_extensions:  EncryptedExtensions;
              case certificate_request:   CertificateRequest;
              case certificate:           Certificate;
              case certificate_verify:    CertificateVerify;
              case finished:              Finished;
              case new_session_ticket:    NewSessionTicket;
              case key_update:            KeyUpdate;
              case extended_key_update:   ExtendedKeyUpdate;
          };
      } Handshake;
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-tls-13-handshake-structure" class="selfRef">TLS 1.3 Handshake Structure.</a>
        </figcaption></figure>
</div>
<div id="tls-13-extended-key-update-example">
<section id="section-5.1">
        <h3 id="name-tls-13-extended-key-update-">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-tls-13-extended-key-update-" class="section-name selfRef">TLS 1.3 Extended Key Update Example</a>
        </h3>
<p id="section-5.1-1">While <a href="#fig-key-update" class="auto internal xref">Figure 1</a> shows the high-level interaction between a
TLS 1.3 client and server, this section shows an example message exchange
with information about the updated keys added.<a href="#section-5.1-1" class="pilcrow">Â¶</a></p>
<p id="section-5.1-2">There are two phases:<a href="#section-5.1-2" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-3">
<li id="section-5.1-3.1">
            <p id="section-5.1-3.1.1">The support for the functionality in this specification
is negotiated in the ClientHello and the EncryptedExtensions
messages.<a href="#section-5.1-3.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li id="section-5.1-3.2">
            <p id="section-5.1-3.2.1">Once the initial handshake is completed, a key update can be
triggered.<a href="#section-5.1-3.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ol>
<p id="section-5.1-4"><a href="#fig-key-update2" class="auto internal xref">Figure 3</a> provides an overview of the exchange starting
with the initial negotiation followed by the key update.<a href="#section-5.1-4" class="pilcrow">Â¶</a></p>
<span id="name-extended-key-update-example"></span><div id="fig-key-update2">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-5.1-5.1">
<pre>
       Client                                           Server

Key  ^ ClientHello
Exch | + key_share
     | + signature_algorithms
     v + extended_key_update
                             --------&gt;
                                                  ServerHello  ^ Key
                                                  + key_share  | Exch
                                                               v
                                        {EncryptedExtensions   ^ Server
                                       + extended_key_update}  | Params
                                         {CertificateRequest}  v
                                                {Certificate}  ^
                                          {CertificateVerify}  | Auth
                                                   {Finished}  v
                               &lt;--------
     ^ {Certificate}
Auth | {CertificateVerify}
     v {Finished}              --------&gt;
                                  ...
                              some time later
                                  ...
 [EKU(key_update_request       --------&gt;
       (with key_share))]
                               &lt;-------- [EKU(key_update_response
                                           (with key_share))]
                                        # Server derives new secrets
# Client derives new secrets
        [EKU(new_key_update)]  --------&gt;
# Client updates SEND keys here
                                    # Server updates RECEIVE keys here
                               &lt;--------  [EKU(new_key_update)]
                                    # Server updates SEND keys here

# Client updates RECEIVE keys here
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-extended-key-update-example" class="selfRef">Extended Key Update Example.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="dtls-13-considerations">
<section id="section-6">
      <h2 id="name-dtls-13-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-dtls-13-considerations" class="section-name selfRef">DTLS 1.3 Considerations</a>
      </h2>
<p id="section-6-1">Unlike TLS 1.3, DTLS 1.3 implementations must take into account that handshake
messages are not transmitted over a reliable transport protocol.<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<p id="section-6-2">Due to the possibility of an <code>ExtendedKeyUpdate(new_key_update)</code> message being
lost and thereby preventing the sender of that message from updating its keying
material, receivers <span class="bcp14">MUST</span> retain the pre-update keying material until receipt
and successful decryption of a message using the new keys.<a href="#section-6-2" class="pilcrow">Â¶</a></p>
<p id="section-6-3">Due to packet loss and/or reordering, DTLS 1.3 peers <span class="bcp14">MAY</span> receive records from an
earlier epoch. If the necessary keys are available, implementations <span class="bcp14">SHOULD</span> attempt
to process such records; however, they <span class="bcp14">MAY</span> choose to discard them.The exchange
has the following steps:<a href="#section-6-3" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-4">
<li id="section-6-4.1">
          <p id="section-6-4.1.1">The initiator sends an <code>ExtendedKeyUpdate(key_update_request)</code> message, which contains a
key share. While an extended key update is in progress, the initiator <span class="bcp14">MUST NOT</span>
initiate further key updates. This message is subject to DTLS handshake
retransmission, but delivery is only confirmed when the initiator either receives the
corresponding <code>ExtendedKeyUpdate(key_update_response)</code> or an ACK.<a href="#section-6-4.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.2">
          <p id="section-6-4.2.1">Upon receipt, the responder sends its own <code>KeyShareEntry</code> in a
<code>ExtendedKeyUpdate(key_update_response)</code> message. While an extended key update
is in progress, the responder <span class="bcp14">MUST NOT</span> initiate further key updates. The responder <span class="bcp14">MAY</span> defer
sending a response if system load or resource constraints prevent immediate processing.
In such cases, the responder <span class="bcp14">MUST</span> acknowledge receipt of the key_update_request with an ACK and, once
sufficient resources become available, retransmit the key_update_response until it is acknowledged by the
initiator.<a href="#section-6-4.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.3">
          <p id="section-6-4.3.1">On receipt of <code>ExtendedKeyUpdate(key_update_response)</code> the initiator derives a secret key based on the
exchanged key shares. This message also serves as an implicit acknowledgment of the
initiatorâs ExtendedKeyUpdate(key_update_request), so no separate ACK is required.<a href="#section-6-4.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.4">
          <p id="section-6-4.4.1">The initiator transmits an <code>ExtendedKeyUpdate(new_key_update)</code> message. This message is subject to DTLS
retransmission until acknowledged.<a href="#section-6-4.4.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.5">
          <p id="section-6-4.5.1">Upon receiving <code>ExtendedKeyUpdate(new_key_update)</code>, the responder <span class="bcp14">MUST</span> update
its receive keys and epoch value.<a href="#section-6-4.5.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.6">
          <p id="section-6-4.6.1">The responder acknowledges the received message by sending its own
<code>ExtendedKeyUpdate(new_key_update)</code>.<a href="#section-6-4.6.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.7">
          <p id="section-6-4.7.1">After the initiator receives the responderâs <code>ExtendedKeyUpdate(new_key_update)</code>,
the initiator <span class="bcp14">MUST</span> update its send key and epoch value. With the receipt of
that message, the initiator <span class="bcp14">MUST</span> also update its receive keys.<a href="#section-6-4.7.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.8">
          <p id="section-6-4.8.1">The initiator <span class="bcp14">MUST</span> acknowledge the responderâs
<code>ExtendedKeyUpdate(new_key_update)</code> with an ACK message.<a href="#section-6-4.8.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-6-4.9">
          <p id="section-6-4.9.1">On receipt of the ACK message, the responder updates its send key and epoch
value. If this ACK is not received, the responder re-transmits its
ExtendedKeyUpdate(new_key_update) until ACK is received. The key update is
complete once this ACK is processed by the responder.<a href="#section-6-4.9.1" class="pilcrow">Â¶</a></p>
</li>
      </ol>
<p id="section-6-5">The handshake framing uses a single <code>HandshakeType</code> for this message
(see <a href="#fig-dtls-handshake" class="auto internal xref">Figure 4</a>).<a href="#section-6-5" class="pilcrow">Â¶</a></p>
<span id="name-dtls-13-handshake-structure"></span><div id="fig-dtls-handshake">
<figure id="figure-4">
        <div class="alignLeft art-text artwork" id="section-6-6.1">
<pre>
       enum {
           client_hello(1),
           server_hello(2),
           new_session_ticket(4),
           end_of_early_data(5),
           encrypted_extensions(8),
           request_connection_id(9),
           new_connection_id(10),
           certificate(11),
           certificate_request(13),
           certificate_verify(15),
           finished(20),
           key_update(24),
           extended_key_update(TBD),  /* new */
           message_hash(254),
           (255)
       } HandshakeType;

       struct {
           HandshakeType msg_type;    /* handshake type */
           uint24 length;             /* bytes in message */
           uint16 message_seq;        /* DTLS-required field */
           uint24 fragment_offset;    /* DTLS-required field */
           uint24 fragment_length;    /* DTLS-required field */
           select (msg_type) {
               case client_hello:          ClientHello;
               case server_hello:          ServerHello;
               case end_of_early_data:     EndOfEarlyData;
               case encrypted_extensions:  EncryptedExtensions;
               case certificate_request:   CertificateRequest;
               case certificate:           Certificate;
               case certificate_verify:    CertificateVerify;
               case finished:              Finished;
               case new_session_ticket:    NewSessionTicket;
               case key_update:            KeyUpdate;
               case extended_key_update:   ExtendedKeyUpdate;
               case request_connection_id: RequestConnectionId;
               case new_connection_id:     NewConnectionId;
           } body;
       } DTLSHandshake;
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-dtls-13-handshake-structure" class="selfRef">DTLS 1.3 Handshake Structure.</a>
        </figcaption></figure>
</div>
<div id="dtls-13-extended-key-update-example">
<section id="section-6.1">
        <h3 id="name-dtls-13-extended-key-update">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-dtls-13-extended-key-update" class="section-name selfRef">DTLS 1.3 Extended Key Update Example</a>
        </h3>
<p id="section-6.1-1">The following example illustrates a successful extended key update,
including how the epochs change during the exchange.<a href="#section-6.1-1" class="pilcrow">Â¶</a></p>
<span id="name-example-dtls-13-extended-ke"></span><div id="dtls-key-update">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-6.1-2.1">
<pre>
Client                            Server
(Initiator)                       (Responder)

  /---------------------------------------\
 |           Initial Handshake             |
  \---------------------------------------/

[C: tx=3, rx=3]                   [S: tx=3, rx=3]
[Application Data]               --------&gt;
[C: tx=3, rx=3]                   [S: tx=3, rx=3]

[C: tx=3, rx=3]                   [S: tx=3, rx=3]
                                  &lt;--------   [Application Data]
[C: tx=3, rx=3]                   [S: tx=3, rx=3]

  /---------------------------------------\
 |           Some time later ...           |
  \---------------------------------------/

[C: tx=3, rx=3]                   [S: tx=3, rx=3]
[EKU(key_update_request)]  --------&gt;
                                  # no epoch change yet

                           &lt;-------- [EKU(key_update_response)]
                                  # still old epochs

[EKU(new_key_update)]      --------&gt;
# Sent under OLD epoch. Client does NOT bump yet.

# Step 6: responder bumps RECEIVE epoch on NKU-in:
# (rx:=rx+1; tx still old)
[C: tx=3, rx=3]                   [S: tx=3, rx=4]

                           &lt;-------- [EKU(new_key_update)]
# Responderâs NKU is tagged with OLD tx (3).

# Epoch switch point:
# Step 8: initiator bumps BOTH tx and rx on NKU-in:
[C: tx=4, rx=4]                   [S: tx=3, rx=4]

[ACK] (tag=new)            --------&gt;

# Step 10: responder bumps SEND epoch on ACK-in:
[C: tx=4, rx=4]                   [S: tx=4, rx=4]

                           &lt;--------   [Application Data]
[C: tx=4, rx=4]                   [S: tx=4, rx=4]

[Application Data]         --------&gt;
[C: tx=4, rx=4]                   [S: tx=4, rx=4]
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-dtls-13-extended-ke" class="selfRef">Example DTLS 1.3 Extended Key Update: Message Exchange.</a>
          </figcaption></figure>
</div>
<p id="section-6.1-3"><a href="#dtls-table" class="auto internal xref">Figure 6</a> shows the steps, the message in flight, and the epoch changes on both sides.
The A/B -&gt; X/Y notation indicates the change of epoch values for tx/rx before and after
the message transmission.<a href="#section-6.1-3" class="pilcrow">Â¶</a></p>
<span id="name-example-dtls-13-extended-key"></span><div id="dtls-table">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-6.1-4.1">
<pre>
+--------------------+----------------+--------------+
| Message            | Client tx/rx   | Server tx/rx |
+--------------------+----------------+--------------+
| APP ------------&gt;  | 3/3 -&gt; 3/3     | 3/3 -&gt; 3/3   |
| &lt;------------ APP  | 3/3 -&gt; 3/3     | 3/3 -&gt; 3/3   |
| req -------------&gt; | 3/3 -&gt; 3/3     | 3/3 -&gt; 3/3   |
| &lt;------------ resp | 3/3 -&gt; 3/3     | 3/3 -&gt; 3/3   |
| NKU  ------------&gt; | 3/3 -&gt; 3/3     | 3/3 -&gt; 3/4   | &lt;- step 6
| &lt;------------- NKU | 3/3 -&gt; 4/4     | 3/4 -&gt; 3/4   | &lt;- step 8
| ACK -------------&gt; | 4/4 -&gt; 4/4     | 3/4 -&gt; 4/4   | &lt;- step 10
| &lt;------------- APP | 4/4 -&gt; 4/4     | 4/4 -&gt; 4/4   |
| APP -------------&gt; | 4/4 -&gt; 4/4     | 4/4 -&gt; 4/4   |
+--------------------+----------------+--------------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-example-dtls-13-extended-key" class="selfRef">Example DTLS 1.3 Extended Key Update: Epoch Changes.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="key_update">
<section id="section-7">
      <h2 id="name-updating-traffic-secrets">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-updating-traffic-secrets" class="section-name selfRef">Updating Traffic Secrets</a>
      </h2>
<p id="section-7-1">When the extended key update message exchange is completed both peers
have successfully updated their application traffic secrets. The
key derivation function described in this document is used to perform
this update.<a href="#section-7-1" class="pilcrow">Â¶</a></p>
<p id="section-7-2">The design of the key derivation function for computing the next
generation of application_traffic_secret is motivated by the desire
to include<a href="#section-7-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.1">
          <p id="section-7-3.1.1">a secret derived from the (EC)DHE exchange (or from the hybrid
key exchange / PQ-KEM exchange),<a href="#section-7-3.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-7-3.2">
          <p id="section-7-3.2.1">a secret that allows the new key exchange to be cryptographically
bound to the previously established secret,<a href="#section-7-3.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-7-3.3">
          <p id="section-7-3.3.1">the concatenation of the <code>ExtendedKeyUpdate(key_update_request)</code> and the
<code>ExtendedKeyUpdate(key_update_response)</code> messages, which contain the key shares,
binding the encapsulated shared secret ciphertext to IKM in case of
hybrid key exchange, providing MAL-BIND-K-CT security (see <span>[<a href="#CDM23" class="cite xref">CDM23</a>]</span>),
and<a href="#section-7-3.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="section-7-3.4">
          <p id="section-7-3.4.1">new label strings to distinguish it from the key derivation used in
TLS 1.3.<a href="#section-7-3.4.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="section-7-4">The following diagram shows the key derivation hierarchy.<a href="#section-7-4" class="pilcrow">Â¶</a></p>
<div class="alignLeft art-text artwork" id="section-7-5">
<pre>
       Master Secret N
             |
             v
       Derive-Secret(., "key derived", "")
             |
             v
 (EC)DHE -&gt; HKDF-Extract = Master Secret N+1
             |
             +-----&gt; Derive-Secret(., "c ap traffic2",
             |                EKU(key_update_request) ||
             |                EKU(key_update_response))
             |                = client_application_traffic_secret_N+1
             |
             +-----&gt; Derive-Secret(., "s ap traffic2",
             |                EKU(key_update_request) ||
             |                EKU(key_update_response))
             |                = server_application_traffic_secret_N+1
             |
             +-----&gt; Derive-Secret(., "exp master2",
             |                EKU(key_update_request) ||
             |                EKU(key_update_response))
             |                = exporter_master_secret_N+1
             |
             +-----&gt; Derive-Secret(., "res master2",
             |                EKU(key_update_request) ||
             |                EKU(key_update_response))
                              = resumption_master_secret_N+1
</pre><a href="#section-7-5" class="pilcrow">Â¶</a>
</div>
<p id="section-7-6">During the initial handshake, the Master Secret is generated (see
<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#section-7.1" class="relref">Section 7.1</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>). Since the Master Secret
is discarded during the key derivation procedure, a derived value is
stored. This stored value then serves as the input salt to the first
key update procedure that incorporates the ephemeral (EC)DHE-
established value as input keying material (IKM) to produce
master_secret_{N+1}. The derived value from this new master secret
serves as input salt to the subsequent key update procedure, which
also incorporates a fresh ephemeral (EC)DHE value as IKM. This
process is repeated for each additional key update procedure.<a href="#section-7-6" class="pilcrow">Â¶</a></p>
<p id="section-7-7">The traffic keys are re-derived from
client_application_traffic_secret_N+1 and
server_application_traffic_secret_N+1, as described in
<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#section-7.3" class="relref">Section 7.3</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>.<a href="#section-7-7" class="pilcrow">Â¶</a></p>
<p id="section-7-8">Once client_/server_application_traffic_secret_N+1 and its associated
traffic keys have been computed, implementations <span class="bcp14">SHOULD</span> delete
client_/server_application_traffic_secret_N and its associated
traffic keys as soon as possible. Note: The
client_/server_application_traffic_secret_N and its associated
traffic keys can only be deleted after receiving the
<code>ExtendedKeyUpdate(new_key_update)</code> message.<a href="#section-7-8" class="pilcrow">Â¶</a></p>
<p id="section-7-9">When using this extension, it is important to consider its interaction with
ticket-based session resumption. If resumption occurs without a new (EC)DH
exchange that provides forward secrecy, an attacker could potentially revert
the security context to an earlier state, thereby negating the benefits of
the extended key update. To preserve the security guarantees provided by key
updates, endpoints <span class="bcp14">MUST</span> either invalidate any session tickets issued prior
to the key update or ensure that resumption always involves a fresh (EC)DH
exchange.<a href="#section-7-9" class="pilcrow">Â¶</a></p>
<p id="section-7-10">If session tickets cannot be stored securely, developers <span class="bcp14">SHOULD</span> consider
disabling ticket-based resumption in their deployments. While this approach
may impact performance, it provides improved security properties.<a href="#section-7-10" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="post-quantum-cryptography-considerations">
<section id="section-8">
      <h2 id="name-post-quantum-cryptography-c">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-post-quantum-cryptography-c" class="section-name selfRef">Post-Quantum Cryptography Considerations</a>
      </h2>
<p id="section-8-1">Hybrid key exchange refers to the simultaneous use of multiple key
exchange algorithms, with the resulting shared secret derived by
combining the outputs of each. The goal of this approach is to maintain
security even if all but one of the component algorithms are later found
to be vulnerable.<a href="#section-8-1" class="pilcrow">Â¶</a></p>
<p id="section-8-2">The transition to post-quantum cryptography has motivated the adoption of
hybrid key exchanges in TLS, as described in
<span>[<a href="#TLS-HYBRID" class="cite xref">TLS-HYBRID</a>]</span>. Specific hybrid groups
have been registered in <span>[<a href="#TLS-ECDHE-MLKEM" class="cite xref">TLS-ECDHE-MLKEM</a>]</span>.
When hybrid key exchange is used, the <code>key_exchange</code> field of each
<code>KeyShareEntry</code> in the initial handshake is formed by concatenating
the <code>key_exchange</code> fields of the constituent algorithms. This same
approach is reused during the Extended Key Update, when new key
shares are exchanged.<a href="#section-8-2" class="pilcrow">Â¶</a></p>
<p id="section-8-3">The specification in <span>[<a href="#TLS-MLKEM" class="cite xref">TLS-MLKEM</a>]</span> registers the lattice-based
ML-KEM algorithm and its variants, such as ML-KEM-512, ML-KEM-768 and
ML-KEM-1024. The KEM encapsulation key or KEM ciphertext is represented
as a 'KeyShareEntry' field. This same approach is reused during the
Extended Key Update, when new key shares are exchanged.<a href="#section-8-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sslkeylogfile-update">
<section id="section-9">
      <h2 id="name-sslkeylogfile-update">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-sslkeylogfile-update" class="section-name selfRef">SSLKEYLOGFILE Update</a>
      </h2>
<p id="section-9-1">As a successful extended key update exchange invalidates previous secrets,
SSLKEYLOGFILE <span>[<a href="#TLS-KEYLOGFILE" class="cite xref">TLS-KEYLOGFILE</a>]</span> needs to be populated with new
entries. As a result, two additional secret labels are utilized in the
SSLKEYLOGFILE:<a href="#section-9-1" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-9-2">
<li id="section-9-2.1">
          <p id="section-9-2.1.1"><code>CLIENT_TRAFFIC_SECRET_N+1</code>: identifies the
client_application_traffic_secret_N+1 in the key schedule<a href="#section-9-2.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-9-2.2">
          <p id="section-9-2.2.1"><code>SERVER_TRAFFIC_SECRET_N+1</code>: identifies the
server_application_traffic_secret_N+1 in the key schedule<a href="#section-9-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li id="section-9-2.3">
          <p id="section-9-2.3.1"><code>EXPORTER_SECRET_N+1</code>: identifies the
exporter_master_secret_N+1 in the key schedule<a href="#section-9-2.3.1" class="pilcrow">Â¶</a></p>
</li>
      </ol>
<p id="section-9-3">Similar to other entries in the SSLKEYLOGFILE, the label is followed by the
32-byte value of the Random field from the ClientHello message that
established the TLS connection, and the corresponding secret encoded in
hexadecimal.<a href="#section-9-3" class="pilcrow">Â¶</a></p>
<p id="section-9-4">SSLKEYLOGFILE entries for the extended key update <span class="bcp14">MUST NOT</span> be produced if
SSLKEYLOGFILE was not used for other secrets in the handshake.<a href="#section-9-4" class="pilcrow">Â¶</a></p>
<p id="section-9-5">Note that each successful Extended Key Update invalidates all previous
SSLKEYLOGFILE secrets including past iterations of <code>CLIENT_TRAFFIC_SECRET_</code>,
<code>SERVER_TRAFFIC_SECRET_</code> and <code>EXPORTER_SECRET_</code>.<a href="#section-9-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="exporter">
<section id="section-10">
      <h2 id="name-exporter">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-exporter" class="section-name selfRef">Exporter</a>
      </h2>
<p id="section-10-1">Protocols such as DTLS-SRTP and DTLS-over-SCTP rely on TLS or DTLS for
key establishment, but reuse portions of the derived keying material for
their own specific purposes.These protocols use the TLS exporter defined
in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#section-7.5" class="relref">Section 7.5</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>.<a href="#section-10-1" class="pilcrow">Â¶</a></p>
<p id="section-10-2">Once the Extended Key Update mechanism is complete, such protocols would
need to use the newly derived key to generate Exported Keying Material
(EKM) to protect packets. The "sk" derived in the <a href="#key_update" class="auto internal xref">Section 7</a> will be
used as the "Secret" in the exporter function, defined in
<span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14#section-7.5" class="relref">Section 7.5</a> of [<a href="#TLS" class="cite xref">TLS</a>]</span>, to generate EKM, ensuring that
the exported keying material is aligned with the updated security context.<a href="#section-10-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">This section discusses additional security and operational aspects introduced by the Extended Key Update mechanism. All security considerations of TLS 1.3 <span>[<a href="#TLS" class="cite xref">TLS</a>]</span> continue to apply.<a href="#section-11-1" class="pilcrow">Â¶</a></p>
<div id="post-compromise-security">
<section id="section-11.1">
        <h3 id="name-post-compromise-security">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-post-compromise-security" class="section-name selfRef">Post-Compromise Security</a>
        </h3>
<p id="section-11.1-1">Extended Key Update provides post-compromise security for long-lived TLS sessions.
To ensure post-compromise security guarantees:<a href="#section-11.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1-2.1">
            <p id="section-11.1-2.1.1">Each update <span class="bcp14">MUST</span> use freshly generated ephemeral key-exchange material. Implementations <span class="bcp14">MUST NOT</span> reuse
ephemeral key-exchange material across updates or across TLS sessions.<a href="#section-11.1-2.1.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="denial-of-service-dos">
<section id="section-11.2">
        <h3 id="name-denial-of-service-dos">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-denial-of-service-dos" class="section-name selfRef">Denial-of-Service (DoS)</a>
        </h3>
<p id="section-11.2-1">The Extended Key Update mechanism increases computational and state-management overhead. A malicious peer could attempt to exhaust CPU or memory resources by initiating excessive update requests.<a href="#section-11.2-1" class="pilcrow">Â¶</a></p>
<p id="section-11.2-2">Implementations <span class="bcp14">SHOULD</span> apply the following mitigations:<a href="#section-11.2-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.2-3.1">
            <p id="section-11.2-3.1.1">Limit the frequency of accepted Extended Key Update requests per session.<a href="#section-11.2-3.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-11.2-3.2">
            <p id="section-11.2-3.2.1">A peer that has sent an Extended Key Update <span class="bcp14">MUST NOT</span> initiate another until the previous update completes.
If a peer violates this rule, the receiving peer <span class="bcp14">MUST</span> treat it as a protocol violation, send an "unexpected_message" alert, and terminate the connection.<a href="#section-11.2-3.2.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="operational-guidance">
<section id="section-11.3">
        <h3 id="name-operational-guidance">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-operational-guidance" class="section-name selfRef">Operational Guidance</a>
        </h3>
<p id="section-11.3-1">Deployments <span class="bcp14">SHOULD</span> evaluate Extended Key Update performance under load and fault conditions, such as high-frequency or concurrent updates. TLS policies <span class="bcp14">SHOULD</span> define explicit rate limits that balance post-compromise security benefits against potential DoS exposure.<a href="#section-11.3-1" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-12">
      <h2 id="name-iana-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="tls-flags">
<section id="section-12.1">
        <h3 id="name-tls-flags">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-tls-flags" class="section-name selfRef">TLS Flags</a>
        </h3>
<p id="section-12.1-1">IANA is requested to add the following entry to the "TLS Flags"
extension registry <span>[<a href="#TLS-Ext-Registry" class="cite xref">TLS-Ext-Registry</a>]</span>:<a href="#section-12.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-12.1-2.1">
            <p id="section-12.1-2.1.1">Value: TBD1<a href="#section-12.1-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.1-2.2">
            <p id="section-12.1-2.2.1">Flag Name: extended_key_update<a href="#section-12.1-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.1-2.3">
            <p id="section-12.1-2.3.1">Messages: CH, EE<a href="#section-12.1-2.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.1-2.4">
            <p id="section-12.1-2.4.1">Recommended: Y<a href="#section-12.1-2.4.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.1-2.5">
            <p id="section-12.1-2.5.1">Reference: [This document]<a href="#section-12.1-2.5.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="tls-handshaketype">
<section id="section-12.2">
        <h3 id="name-tls-handshaketype">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-tls-handshaketype" class="section-name selfRef">TLS HandshakeType</a>
        </h3>
<p id="section-12.2-1">IANA is requested to add the following entry to the "TLS HandshakeType"
registry <span>[<a href="#TLS-Ext-Registry" class="cite xref">TLS-Ext-Registry</a>]</span>:<a href="#section-12.2-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="section-12.2-2.1">
            <p id="section-12.2-2.1.1">Value: TBD2<a href="#section-12.2-2.1.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.2-2.2">
            <p id="section-12.2-2.2.1">Description: extended_key_update<a href="#section-12.2-2.2.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.2-2.3">
            <p id="section-12.2-2.3.1">DTLS-OK: Y<a href="#section-12.2-2.3.1" class="pilcrow">Â¶</a></p>
</li>
          <li class="normal" id="section-12.2-2.4">
            <p id="section-12.2-2.4.1">Reference: [This document]<a href="#section-12.2-2.4.1" class="pilcrow">Â¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="iana-eku-registry">
<section id="section-12.3">
        <h3 id="name-extendedkeyupdate-message-s">
<a href="#section-12.3" class="section-number selfRef">12.3. </a><a href="#name-extendedkeyupdate-message-s" class="section-name selfRef">ExtendedKeyUpdate Message Subtypes Registry</a>
        </h3>
<p id="section-12.3-1">IANA is requested to create a new registry "TLS ExtendedKeyUpdate Message Subtypes", within the
existing "Transport Layer Security (TLS) Parameters" registry <span>[<a href="#TLS-Ext-Registry" class="cite xref">TLS-Ext-Registry</a>]</span>.
This new registry reserves types used for Extended Key Update entries.
The initial contents of this registry are as follows.<a href="#section-12.3-1" class="pilcrow">Â¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">DTLS-OK</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">key_update_request</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">key_update_response</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">new_key_update</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3-255</td>
              <td class="text-left" rowspan="1" colspan="1">Unassigned</td>
              <td class="text-left" rowspan="1" colspan="1">Â </td>
              <td class="text-left" rowspan="1" colspan="1">Â </td>
            </tr>
          </tbody>
        </table>
<p id="section-12.3-3">New assignments in the "TLS ExtendedKeyUpdate Types" registry will be administered by
IANA through Specification Required procedure <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.  The role of the
designated expert is described in <span><a href="https://rfc-editor.org/rfc/rfc8447#section-17" class="relref">Section 17</a> of [<a href="#RFC8447" class="cite xref">RFC8447</a>]</span>.  The designated expert
<span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span> ensures that the specification is publicly available.  It is sufficient to
have an Internet-Draft (that is posted and never published as an RFC) or to cite a
document from another standards body, industry consortium, or any other location.
An expert may provide more in-depth reviews, but their approval should not be taken as an
endorsement of the ExtendedKeyUpdate Message Subtype.<a href="#section-12.3-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sslkeylogfile-labels">
<section id="section-12.4">
        <h3 id="name-sslkeylogfile-labels">
<a href="#section-12.4" class="section-number selfRef">12.4. </a><a href="#name-sslkeylogfile-labels" class="section-name selfRef">SSLKEYLOGFILE labels</a>
        </h3>
<p id="section-12.4-1">IANA is requested to add the following entries to the "TLS SSLKEYLOGFILE Labels"
extension registry <span>[<a href="#TLS-Ext-Registry" class="cite xref">TLS-Ext-Registry</a>]</span>:<a href="#section-12.4-1" class="pilcrow">Â¶</a></p>
<table class="center" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
              <th class="text-left" rowspan="1" colspan="1">Comment</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">CLIENT_TRAFFIC_SECRET_N+1</td>
              <td class="text-left" rowspan="1" colspan="1">Secret protecting client records after Extended Key Update</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
              <td class="text-left" rowspan="1" colspan="1">N represents iteration of Extended Key Update</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">SERVER_TRAFFIC_SECRET_N+1</td>
              <td class="text-left" rowspan="1" colspan="1">Secret protecting server records after Extended Key Update</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
              <td class="text-left" rowspan="1" colspan="1">N represents iteration of Extended Key Update</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">EXPORTER_SECRET_N+1</td>
              <td class="text-left" rowspan="1" colspan="1">Exporter secret after Extended Key Update</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
              <td class="text-left" rowspan="1" colspan="1">N represents iteration of Extended Key Update</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="DTLS">[DTLS]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 9147</span>, <span class="seriesInfo">DOI 10.17487/RFC9147</span>, <time datetime="2022-04" class="refDate">April 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9147">https://www.rfc-editor.org/rfc/rfc9147</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS">[TLS]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-rfc8446bis-14</span>, <time datetime="2025-09-13" class="refDate">13 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14">https://datatracker.ietf.org/doc/html/draft-ietf-tls-rfc8446bis-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-FLAGS">[TLS-FLAGS]</dt>
      <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refTitle">"A Flags Extension for TLS 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-tlsflags-16</span>, <time datetime="2025-09-14" class="refDate">14 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-tlsflags-16">https://datatracker.ietf.org/doc/html/draft-ietf-tls-tlsflags-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ANSSI">[ANSSI]</dt>
        <dd>
<span class="refAuthor">ANSSI</span>, <span class="refTitle">"Recommendations for securing networks with IPsec, Technical Report"</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://cyber.gouv.fr/sites/default/files/2012/09/NT_IPsec_EN.pdf">https://cyber.gouv.fr/sites/default/files/2012/09/NT_IPsec_EN.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CCG16">[CCG16]</dt>
        <dd>
<span class="refAuthor">Cohn-Gordon, K.</span>, <span class="refAuthor">Cremers, C.</span>, and <span class="refAuthor">L. Garratt</span>, <span class="refTitle">"On Post-compromise Security"</span>, <span class="refContent">IEEE</span>, <span class="seriesInfo">2016 IEEE 29th Computer Security Foundations Symposium (CSF) pp. 164-178</span>, <span class="seriesInfo">DOI 10.1109/csf.2016.19</span>, <time datetime="2016-06" class="refDate">June 2016</time>, <span>&lt;<a href="https://doi.org/10.1109/csf.2016.19">https://doi.org/10.1109/csf.2016.19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CDM23">[CDM23]</dt>
        <dd>
<span class="refAuthor">ACM</span>, <span class="refTitle">"Keeping Up with the KEMs: Stronger Security Notions for KEMs and automated analysis of KEM-based protocols"</span>, <time datetime="2023-11" class="refDate">November 2023</time>, <span>&lt;<a href="https://eprint.iacr.org/2023/1933.pdf">https://eprint.iacr.org/2023/1933.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONFIDENTIALITY">[CONFIDENTIALITY]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Schneier, B.</span>, <span class="refAuthor">Jennings, C.</span>, <span class="refAuthor">Hardie, T.</span>, <span class="refAuthor">Trammell, B.</span>, <span class="refAuthor">Huitema, C.</span>, and <span class="refAuthor">D. Borkmann</span>, <span class="refTitle">"Confidentiality in the Face of Pervasive Surveillance: A Threat Model and Problem Statement"</span>, <span class="seriesInfo">RFC 7624</span>, <span class="seriesInfo">DOI 10.17487/RFC7624</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7624">https://www.rfc-editor.org/rfc/rfc7624</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8447">[RFC8447]</dt>
        <dd>
<span class="refAuthor">Salowey, J.</span> and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"IANA Registry Updates for TLS and DTLS"</span>, <span class="seriesInfo">RFC 8447</span>, <span class="seriesInfo">DOI 10.17487/RFC8447</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8447">https://www.rfc-editor.org/rfc/rfc8447</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-ECDHE-MLKEM">[TLS-ECDHE-MLKEM]</dt>
        <dd>
<span class="refAuthor">Kwiatkowski, K.</span>, <span class="refAuthor">Kampanakis, P.</span>, <span class="refAuthor">Westerbaan, B.</span>, and <span class="refAuthor">D. Stebila</span>, <span class="refTitle">"Post-quantum hybrid ECDHE-MLKEM Key Agreement for TLSv1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-ecdhe-mlkem-01</span>, <time datetime="2025-09-29" class="refDate">29 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-ecdhe-mlkem-01">https://datatracker.ietf.org/doc/html/draft-ietf-tls-ecdhe-mlkem-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-Ext-Registry">[TLS-Ext-Registry]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Transport Layer Security (TLS) Extensions"</span>, <time datetime="2023-11" class="refDate">November 2023</time>, <span>&lt;<a href="https://www.iana.org/assignments/tls-extensiontype-values">https://www.iana.org/assignments/tls-extensiontype-values</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-HYBRID">[TLS-HYBRID]</dt>
        <dd>
<span class="refAuthor">Stebila, D.</span>, <span class="refAuthor">Fluhrer, S.</span>, and <span class="refAuthor">S. Gueron</span>, <span class="refTitle">"Hybrid key exchange in TLS 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-hybrid-design-16</span>, <time datetime="2025-09-07" class="refDate">7 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-hybrid-design-16">https://datatracker.ietf.org/doc/html/draft-ietf-tls-hybrid-design-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-KEYLOGFILE">[TLS-KEYLOGFILE]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refAuthor">Rosomakho, Y.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"The SSLKEYLOGFILE Format for TLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-keylogfile-05</span>, <time datetime="2025-06-09" class="refDate">9 June 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-keylogfile-05">https://datatracker.ietf.org/doc/html/draft-ietf-tls-keylogfile-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-MLKEM">[TLS-MLKEM]</dt>
        <dd>
<span class="refAuthor">Connolly, D.</span>, <span class="refTitle">"ML-KEM Post-Quantum Key Agreement for TLS 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-mlkem-04</span>, <time datetime="2025-07-22" class="refDate">22 July 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-mlkem-04">https://datatracker.ietf.org/doc/html/draft-ietf-tls-mlkem-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS-RENEGOTIATION">[TLS-RENEGOTIATION]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Ray, M.</span>, <span class="refAuthor">Dispensa, S.</span>, and <span class="refAuthor">N. Oskov</span>, <span class="refTitle">"Transport Layer Security (TLS) Renegotiation Indication Extension"</span>, <span class="seriesInfo">RFC 5746</span>, <span class="seriesInfo">DOI 10.17487/RFC5746</span>, <time datetime="2010-02" class="refDate">February 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5746">https://www.rfc-editor.org/rfc/rfc5746</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">We would like to thank the members of the "TSVWG DTLS for SCTP
Requirements Design Team" for their discussion. The members, in
no particular order, were:<a href="#appendix-A-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-2.1">
          <p id="appendix-A-2.1.1">Marcelo Ricardo Leitner<a href="#appendix-A-2.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.2">
          <p id="appendix-A-2.2.1">Zaheduzzaman Sarker<a href="#appendix-A-2.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.3">
          <p id="appendix-A-2.3.1">Magnus Westerlund<a href="#appendix-A-2.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.4">
          <p id="appendix-A-2.4.1">John Mattsson<a href="#appendix-A-2.4.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.5">
          <p id="appendix-A-2.5.1">Claudio Porfiri<a href="#appendix-A-2.5.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.6">
          <p id="appendix-A-2.6.1">Xin Long<a href="#appendix-A-2.6.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.7">
          <p id="appendix-A-2.7.1">Michael TÃ¼xen<a href="#appendix-A-2.7.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.8">
          <p id="appendix-A-2.8.1">Hannes Tschofenig<a href="#appendix-A-2.8.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.9">
          <p id="appendix-A-2.9.1">K Tirumaleswar Reddy<a href="#appendix-A-2.9.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-A-2.10">
          <p id="appendix-A-2.10.1">Bertrand Rault<a href="#appendix-A-2.10.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<p id="appendix-A-3">Additionally, we would like to thank the chairs of the
Transport and Services Working Group (tsvwg) Gorry Fairhurst and
Marten Seemann as well as the responsible area director Martin Duke.<a href="#appendix-A-3" class="pilcrow">Â¶</a></p>
<p id="appendix-A-4">Finally, we would like to thank Martin Thomson, Ilari Liusvaara,
Benjamin Kaduk, Scott Fluhrer, Dennis Jackson, David Benjamin,
Matthijs van Duin, Rifaat Shekh-Yusef, Joe Birr-Pixton, Eric Rescorla,
and Thom Wiggers for their review comments.<a href="#appendix-A-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="state-machines">
<section id="appendix-B">
      <h2 id="name-state-machines">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-state-machines" class="section-name selfRef">State Machines</a>
      </h2>
<p id="appendix-B-1">The sections below describe the state machines for the extended key update
operation for TLS 1.3 and DTLS 1.3.<a href="#appendix-B-1" class="pilcrow">Â¶</a></p>
<p id="appendix-B-2">For editorial reasons we abbreviate the protocol message types:<a href="#appendix-B-2" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">
          <p id="appendix-B-3.1.1">Req - ExtendedKeyUpdate(request)<a href="#appendix-B-3.1.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.2">
          <p id="appendix-B-3.2.1">Resp - ExtendedKeyUpdate(response)<a href="#appendix-B-3.2.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.3">
          <p id="appendix-B-3.3.1">NKU - ExtendedKeyUpdate(new_key_update)<a href="#appendix-B-3.3.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.4">
          <p id="appendix-B-3.4.1">ACK - Acknowledgement message from <span><a href="https://rfc-editor.org/rfc/rfc9147#section-7" class="relref">Section 7</a> of [<a href="#DTLS" class="cite xref">DTLS</a>]</span><a href="#appendix-B-3.4.1" class="pilcrow">Â¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.5">
          <p id="appendix-B-3.5.1">APP - application data payloads<a href="#appendix-B-3.5.1" class="pilcrow">Â¶</a></p>
</li>
      </ul>
<div id="tls-13-state-machines">
<section id="appendix-B.1">
        <h3 id="name-tls-13-state-machines">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-tls-13-state-machines" class="section-name selfRef">TLS 1.3 State Machines</a>
        </h3>
<p id="appendix-B.1-1">This section describes the initiator and responder state machines.<a href="#appendix-B.1-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="initiator-state-machine">
<section id="appendix-B.2">
        <h3 id="name-initiator-state-machine">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-initiator-state-machine" class="section-name selfRef">Initiator State Machine</a>
        </h3>
<div id="appendix-B.2-1">
          <div class="alignLeft art-svg artwork" id="appendix-B.2-1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="640" width="520" viewBox="0 0 520 640" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,32 L 8,112" fill="none" stroke="black"></path>
              <path d="M 8,192 L 8,240" fill="none" stroke="black"></path>
              <path d="M 8,416 L 8,496" fill="none" stroke="black"></path>
              <path d="M 8,592 L 8,624" fill="none" stroke="black"></path>
              <path d="M 48,248 L 48,408" fill="none" stroke="black"></path>
              <path d="M 192,32 L 192,112" fill="none" stroke="black"></path>
              <path d="M 192,192 L 192,240" fill="none" stroke="black"></path>
              <path d="M 192,592 L 192,624" fill="none" stroke="black"></path>
              <path d="M 232,416 L 232,496" fill="none" stroke="black"></path>
              <path d="M 8,32 L 192,32" fill="none" stroke="black"></path>
              <path d="M 8,112 L 192,112" fill="none" stroke="black"></path>
              <path d="M 8,192 L 192,192" fill="none" stroke="black"></path>
              <path d="M 8,240 L 192,240" fill="none" stroke="black"></path>
              <path d="M 408,384 L 424,384" fill="none" stroke="black"></path>
              <path d="M 8,416 L 232,416" fill="none" stroke="black"></path>
              <path d="M 8,496 L 232,496" fill="none" stroke="black"></path>
              <path d="M 408,544 L 424,544" fill="none" stroke="black"></path>
              <path d="M 8,592 L 192,592" fill="none" stroke="black"></path>
              <path d="M 8,624 L 192,624" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="416,544 404,538.4 404,549.6" fill="black" transform="rotate(180,408,544)"></polygon>
              <polygon class="arrowhead" points="416,384 404,378.4 404,389.6" fill="black" transform="rotate(180,408,384)"></polygon>
              <polygon class="arrowhead" points="56,408 44,402.4 44,413.6" fill="black" transform="rotate(90,48,408)"></polygon>
              <g class="text">
                <text x="56" y="52">START</text>
                <text x="104" y="68">send_key=current,</text>
                <text x="112" y="84">receive_key=current</text>
                <text x="76" y="100">updating=0</text>
                <text x="88" y="132">|</text>
                <text x="24" y="148">(1)</text>
                <text x="60" y="148">send</text>
                <text x="96" y="148">Req</text>
                <text x="56" y="164">set</text>
                <text x="116" y="164">updating=1</text>
                <text x="88" y="180">v</text>
                <text x="96" y="212">WAIT_RESP</text>
                <text x="100" y="228">updating=1</text>
                <text x="152" y="260">|</text>
                <text x="152" y="276">Resp(rejected/clashed):</text>
                <text x="88" y="292">set</text>
                <text x="148" y="292">updating=0</text>
                <text x="84" y="308">-&gt;</text>
                <text x="132" y="308">FINISHED</text>
                <text x="184" y="308">(no</text>
                <text x="232" y="308">change)</text>
                <text x="116" y="340">Resp(accepted)</text>
                <text x="196" y="340">with</text>
                <text x="260" y="340">key_share:</text>
                <text x="100" y="356">derive</text>
                <text x="144" y="356">new</text>
                <text x="192" y="356">secrets</text>
                <text x="92" y="372">send</text>
                <text x="128" y="372">NKU</text>
                <text x="196" y="372">(encrypted</text>
                <text x="264" y="372">under</text>
                <text x="304" y="372">old</text>
                <text x="344" y="372">keys)</text>
                <text x="100" y="388">update</text>
                <text x="148" y="388">SEND</text>
                <text x="188" y="388">keys</text>
                <text x="248" y="388">(send_key</text>
                <text x="300" y="388">:=</text>
                <text x="328" y="388">new</text>
                <text x="364" y="388">key)</text>
                <text x="448" y="388">TLS</text>
                <text x="484" y="388">step</text>
                <text x="512" y="388">4</text>
                <text x="60" y="436">SENT_NKU</text>
                <text x="104" y="436">/</text>
                <text x="156" y="436">WAIT_R_NKU</text>
                <text x="80" y="452">send_key=new,</text>
                <text x="108" y="468">receive_key=current,</text>
                <text x="68" y="484">updating=1</text>
                <text x="88" y="516">|</text>
                <text x="24" y="532">(5)</text>
                <text x="60" y="532">recv</text>
                <text x="96" y="532">NKU</text>
                <text x="156" y="532">(encrypted</text>
                <text x="224" y="532">under</text>
                <text x="264" y="532">old</text>
                <text x="304" y="532">keys)</text>
                <text x="68" y="548">update</text>
                <text x="128" y="548">RECEIVE</text>
                <text x="180" y="548">keys</text>
                <text x="252" y="548">(receive_key</text>
                <text x="316" y="548">:=</text>
                <text x="344" y="548">new</text>
                <text x="380" y="548">key)</text>
                <text x="452" y="548">Step</text>
                <text x="480" y="548">5</text>
                <text x="56" y="564">set</text>
                <text x="116" y="564">updating=0</text>
                <text x="88" y="580">v</text>
                <text x="100" y="612">FINISHED</text>
              </g>
            </svg><a href="#appendix-B.2-1.1" class="pilcrow">Â¶</a>
</div>
</div>
</section>
</div>
<div id="responder-state-machine">
<section id="appendix-B.3">
        <h3 id="name-responder-state-machine">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-responder-state-machine" class="section-name selfRef">Responder State Machine</a>
        </h3>
<div id="appendix-B.3-1">
          <div class="alignLeft art-svg artwork" id="appendix-B.3-1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="640" width="520" viewBox="0 0 520 640" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,32 L 8,112" fill="none" stroke="black"></path>
              <path d="M 8,192 L 8,224" fill="none" stroke="black"></path>
              <path d="M 8,416 L 8,464" fill="none" stroke="black"></path>
              <path d="M 8,592 L 8,624" fill="none" stroke="black"></path>
              <path d="M 48,232 L 48,408" fill="none" stroke="black"></path>
              <path d="M 192,32 L 192,112" fill="none" stroke="black"></path>
              <path d="M 192,192 L 192,224" fill="none" stroke="black"></path>
              <path d="M 192,416 L 192,464" fill="none" stroke="black"></path>
              <path d="M 192,592 L 192,624" fill="none" stroke="black"></path>
              <path d="M 8,32 L 192,32" fill="none" stroke="black"></path>
              <path d="M 8,112 L 192,112" fill="none" stroke="black"></path>
              <path d="M 8,192 L 192,192" fill="none" stroke="black"></path>
              <path d="M 8,224 L 192,224" fill="none" stroke="black"></path>
              <path d="M 8,416 L 192,416" fill="none" stroke="black"></path>
              <path d="M 8,464 L 192,464" fill="none" stroke="black"></path>
              <path d="M 408,512 L 424,512" fill="none" stroke="black"></path>
              <path d="M 408,544 L 424,544" fill="none" stroke="black"></path>
              <path d="M 8,592 L 192,592" fill="none" stroke="black"></path>
              <path d="M 8,624 L 192,624" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="416,544 404,538.4 404,549.6" fill="black" transform="rotate(180,408,544)"></polygon>
              <polygon class="arrowhead" points="416,512 404,506.4 404,517.6" fill="black" transform="rotate(180,408,512)"></polygon>
              <polygon class="arrowhead" points="56,408 44,402.4 44,413.6" fill="black" transform="rotate(90,48,408)"></polygon>
              <g class="text">
                <text x="56" y="52">START</text>
                <text x="104" y="68">send_key=current,</text>
                <text x="112" y="84">receive_key=current</text>
                <text x="76" y="100">updating=0</text>
                <text x="88" y="132">|</text>
                <text x="24" y="148">(2)</text>
                <text x="60" y="148">recv</text>
                <text x="96" y="148">Req</text>
                <text x="56" y="164">set</text>
                <text x="116" y="164">updating=1</text>
                <text x="88" y="180">v</text>
                <text x="96" y="212">RESPOND</text>
                <text x="152" y="244">|</text>
                <text x="120" y="260">reject/clashed:</text>
                <text x="92" y="276">send</text>
                <text x="164" y="276">Resp(status)</text>
                <text x="88" y="292">set</text>
                <text x="148" y="292">updating=0</text>
                <text x="84" y="308">-&gt;</text>
                <text x="132" y="308">FINISHED</text>
                <text x="184" y="308">(no</text>
                <text x="232" y="308">change)</text>
                <text x="88" y="340">accept:</text>
                <text x="92" y="356">send</text>
                <text x="172" y="356">Resp(accepted)</text>
                <text x="252" y="356">with</text>
                <text x="312" y="356">key_share</text>
                <text x="100" y="372">derive</text>
                <text x="144" y="372">new</text>
                <text x="192" y="372">secrets</text>
                <text x="84" y="388">-&gt;</text>
                <text x="140" y="388">WAIT_I_NKU</text>
                <text x="92" y="436">WAIT_I_NKU</text>
                <text x="92" y="452">updating=1</text>
                <text x="88" y="484">|</text>
                <text x="24" y="500">(4)</text>
                <text x="60" y="500">recv</text>
                <text x="96" y="500">NKU</text>
                <text x="156" y="500">(encrypted</text>
                <text x="224" y="500">under</text>
                <text x="264" y="500">old</text>
                <text x="304" y="500">keys)</text>
                <text x="68" y="516">update</text>
                <text x="128" y="516">RECEIVE</text>
                <text x="180" y="516">keys</text>
                <text x="252" y="516">(receive_key</text>
                <text x="316" y="516">:=</text>
                <text x="344" y="516">new</text>
                <text x="380" y="516">key)</text>
                <text x="448" y="516">TLS</text>
                <text x="484" y="516">step</text>
                <text x="512" y="516">4</text>
                <text x="60" y="532">send</text>
                <text x="96" y="532">NKU</text>
                <text x="156" y="532">(encrypted</text>
                <text x="224" y="532">under</text>
                <text x="264" y="532">old</text>
                <text x="304" y="532">keys)</text>
                <text x="68" y="548">update</text>
                <text x="116" y="548">SEND</text>
                <text x="156" y="548">keys</text>
                <text x="216" y="548">(send_key</text>
                <text x="268" y="548">:=</text>
                <text x="296" y="548">new</text>
                <text x="332" y="548">key)</text>
                <text x="448" y="548">TLS</text>
                <text x="484" y="548">step</text>
                <text x="512" y="548">4</text>
                <text x="56" y="564">set</text>
                <text x="116" y="564">updating=0</text>
                <text x="88" y="580">v</text>
                <text x="100" y="612">FINISHED</text>
              </g>
            </svg><a href="#appendix-B.3-1.1" class="pilcrow">Â¶</a>
</div>
</div>
</section>
</div>
<div id="dtls-13-state-machines">
<section id="appendix-B.4">
        <h3 id="name-dtls-13-state-machines">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-dtls-13-state-machines" class="section-name selfRef">DTLS 1.3 State Machines</a>
        </h3>
<p id="appendix-B.4-1">This section describes the initiator and responder state machines.<a href="#appendix-B.4-1" class="pilcrow">Â¶</a></p>
<div id="terms-and-abbreviations">
<section id="appendix-B.4.1">
          <h4 id="name-terms-and-abbreviations">
<a href="#appendix-B.4.1" class="section-number selfRef">B.4.1. </a><a href="#name-terms-and-abbreviations" class="section-name selfRef">Terms and Abbreviations</a>
          </h4>
<p id="appendix-B.4.1-1">The following variables and abbreviations are used in the state machine diagrams.<a href="#appendix-B.4.1-1" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.4.1-2.1">
              <p id="appendix-B.4.1-2.1.1">rx - current, accepted receive epoch.<a href="#appendix-B.4.1-2.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.2">
              <p id="appendix-B.4.1-2.2.1">tx - current transmit epoch used for tagging outgoing messages.<a href="#appendix-B.4.1-2.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.3">
              <p id="appendix-B.4.1-2.3.1">E - initial epoch value.<a href="#appendix-B.4.1-2.3.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.4">
              <p id="appendix-B.4.1-2.4.1">updating - true while a key-update handshake is in progress.<a href="#appendix-B.4.1-2.4.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.5">
              <p id="appendix-B.4.1-2.5.1">old_rx - the previous receive epoch remembered during retention.<a href="#appendix-B.4.1-2.5.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.6">
              <p id="appendix-B.4.1-2.6.1">retain_old - when true, receiver accepts tags old_rx and rx.<a href="#appendix-B.4.1-2.6.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.7">
              <p id="appendix-B.4.1-2.7.1">tag=... - the TX-epoch value written on an outgoing message.<a href="#appendix-B.4.1-2.7.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.8">
              <p id="appendix-B.4.1-2.8.1">e==... - the epoch tag carried on an incoming message (what the peer sent).<a href="#appendix-B.4.1-2.8.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.1-2.9">
              <p id="appendix-B.4.1-2.9.1">FINISHED / START / WAIT_RESP / WAIT_I_NKU / WAIT_R_NKU / ACTIVATE RETENTION / RESPOND / WAIT_ACK - diagram states; FINISHED denotes the steady state after success.<a href="#appendix-B.4.1-2.9.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<p id="appendix-B.4.1-3">Crossed requests. If both peers independently initiate the extended key update and the key_update_request messages cross in flight, compare the KeyShareEntry.key_exchange values. The request with the lower lexicographic value must be ignored. If the values are equal, the endpoint must abort with an "unexpected_message" alert. If the peer's value is higher than the local one, the endpoint abandons its in-flight update and processes the peer's request as responder.<a href="#appendix-B.4.1-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.1-4">No status in responses. ExtendedKeyUpdate(key_update_response) carries only a KeyShareEntry; there is no accept/reject/status field in the wire format. Implementations either proceed normally or abort on error; there is no benign "reject" reply.<a href="#appendix-B.4.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="state-machine-initiator">
<section id="appendix-B.4.2">
          <h4 id="name-state-machine-initiator">
<a href="#appendix-B.4.2" class="section-number selfRef">B.4.2. </a><a href="#name-state-machine-initiator" class="section-name selfRef">State Machine (Initiator)</a>
          </h4>
<p id="appendix-B.4.2-1">The initiator starts in the START state with matching epochs (rx := E; tx := E). It sends a Req and enters WAIT_RESP (updating := 1). While waiting, APP data may be sent at any time (tagged with the current tx) and received according to the APP acceptance rule below.<a href="#appendix-B.4.2-1" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.2-2">Once the responder returns Resp with a tag matching the current rx, the initiator derives new key material. It then sends NKU still tagged with the old tx, moving to WAIT_R_NKU.<a href="#appendix-B.4.2-2" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.2-3">If a peer key_update_request arrives while in WAIT_RESP (crossed updates), apply the crossed-request rule above. If the peer's key_exchange is higher, abandon the local update (updating := 0) and continue as responder: send key_update_response, derive new secrets, then proceed with the responder flow. If lower, ignore the peer's request; if equal, abort with "unexpected_message".<a href="#appendix-B.4.2-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.2-4">Upon receiving the responder's NKU (tag equals the current rx, meaning the responder is still tagging with its old tx), the initiator:<a href="#appendix-B.4.2-4" class="pilcrow">Â¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B.4.2-5">
<li id="appendix-B.4.2-5.1">
              <p id="appendix-B.4.2-5.1.1">activates retention (old_rx := rx; retain_old := 1),<a href="#appendix-B.4.2-5.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="appendix-B.4.2-5.2">
              <p id="appendix-B.4.2-5.2.1">increments both epochs (rx++, tx++),<a href="#appendix-B.4.2-5.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="appendix-B.4.2-5.3">
              <p id="appendix-B.4.2-5.3.1">sends ACK tagged with the new tx (which now equals the new rx),<a href="#appendix-B.4.2-5.3.1" class="pilcrow">Â¶</a></p>
</li>
            <li id="appendix-B.4.2-5.4">
              <p id="appendix-B.4.2-5.4.1">clears updating and enters FINISHED.<a href="#appendix-B.4.2-5.4.1" class="pilcrow">Â¶</a></p>
</li>
          </ol>
<p id="appendix-B.4.2-6">Retention at the initiator ends automatically on the first APP received under the new rx (then retain_old := 0). APP traffic is otherwise permitted at any time; reordering is tolerated by the acceptance rule.<a href="#appendix-B.4.2-6" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.2-7">APP acceptance rule (receiver): accept if e == rx or (retain_old &amp;&amp; e == old_rx). If retain_old is set and an APP with the new rx arrives, clear retain_old.<a href="#appendix-B.4.2-7" class="pilcrow">Â¶</a></p>
<div id="appendix-B.4.2-8">
            <div class="alignLeft art-svg artwork" id="appendix-B.4.2-8.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="880" width="584" viewBox="0 0 584 880" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 8,192" fill="none" stroke="black"></path>
                <path d="M 8,512 L 8,544" fill="none" stroke="black"></path>
                <path d="M 8,656 L 8,736" fill="none" stroke="black"></path>
                <path d="M 8,816 L 8,864" fill="none" stroke="black"></path>
                <path d="M 16,200 L 16,432" fill="none" stroke="black"></path>
                <path d="M 56,200 L 56,320" fill="none" stroke="black"></path>
                <path d="M 56,352 L 56,400" fill="none" stroke="black"></path>
                <path d="M 56,552 L 56,592" fill="none" stroke="black"></path>
                <path d="M 88,464 L 88,504" fill="none" stroke="black"></path>
                <path d="M 96,200 L 96,320" fill="none" stroke="black"></path>
                <path d="M 96,352 L 96,368" fill="none" stroke="black"></path>
                <path d="M 192,200 L 192,256" fill="none" stroke="black"></path>
                <path d="M 192,656 L 192,736" fill="none" stroke="black"></path>
                <path d="M 256,160 L 256,192" fill="none" stroke="black"></path>
                <path d="M 256,512 L 256,544" fill="none" stroke="black"></path>
                <path d="M 280,32 L 280,80" fill="none" stroke="black"></path>
                <path d="M 352,816 L 352,864" fill="none" stroke="black"></path>
                <path d="M 8,32 L 280,32" fill="none" stroke="black"></path>
                <path d="M 8,80 L 280,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 256,160" fill="none" stroke="black"></path>
                <path d="M 8,192 L 256,192" fill="none" stroke="black"></path>
                <path d="M 192,256 L 208,256" fill="none" stroke="black"></path>
                <path d="M 96,368 L 112,368" fill="none" stroke="black"></path>
                <path d="M 56,400 L 72,400" fill="none" stroke="black"></path>
                <path d="M 16,432 L 32,432" fill="none" stroke="black"></path>
                <path d="M 8,512 L 256,512" fill="none" stroke="black"></path>
                <path d="M 8,544 L 256,544" fill="none" stroke="black"></path>
                <path d="M 8,656 L 192,656" fill="none" stroke="black"></path>
                <path d="M 8,736 L 192,736" fill="none" stroke="black"></path>
                <path d="M 8,816 L 352,816" fill="none" stroke="black"></path>
                <path d="M 8,864 L 352,864" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="200,200 188,194.4 188,205.6" fill="black" transform="rotate(270,192,200)"></polygon>
                <polygon class="arrowhead" points="104,200 92,194.4 92,205.6" fill="black" transform="rotate(270,96,200)"></polygon>
                <polygon class="arrowhead" points="96,504 84,498.4 84,509.6" fill="black" transform="rotate(90,88,504)"></polygon>
                <polygon class="arrowhead" points="64,200 52,194.4 52,205.6" fill="black" transform="rotate(270,56,200)"></polygon>
                <polygon class="arrowhead" points="24,200 12,194.4 12,205.6" fill="black" transform="rotate(270,16,200)"></polygon>
                <g class="text">
                  <text x="40" y="52">START</text>
                  <text x="28" y="68">rx</text>
                  <text x="52" y="68">:=</text>
                  <text x="76" y="68">E;</text>
                  <text x="100" y="68">tx</text>
                  <text x="124" y="68">:=</text>
                  <text x="148" y="68">E,</text>
                  <text x="196" y="68">updating</text>
                  <text x="244" y="68">:=</text>
                  <text x="264" y="68">0</text>
                  <text x="56" y="100">|</text>
                  <text x="16" y="116">(1)</text>
                  <text x="52" y="116">send</text>
                  <text x="88" y="116">Req</text>
                  <text x="140" y="116">[tag=tx]</text>
                  <text x="48" y="132">set</text>
                  <text x="100" y="132">updating</text>
                  <text x="148" y="132">:=</text>
                  <text x="168" y="132">1</text>
                  <text x="56" y="148">v</text>
                  <text x="56" y="180">WAIT_RESP</text>
                  <text x="232" y="260">(A)</text>
                  <text x="268" y="260">recv</text>
                  <text x="308" y="260">peer</text>
                  <text x="344" y="260">Req</text>
                  <text x="404" y="260">(crossed):</text>
                  <text x="236" y="276">if</text>
                  <text x="268" y="276">peer</text>
                  <text x="296" y="276">&lt;</text>
                  <text x="328" y="276">local</text>
                  <text x="372" y="276">-&gt;</text>
                  <text x="412" y="276">IGNORE</text>
                  <text x="488" y="276">(Self-Loop)</text>
                  <text x="236" y="292">if</text>
                  <text x="268" y="292">peer</text>
                  <text x="300" y="292">==</text>
                  <text x="336" y="292">local</text>
                  <text x="372" y="292">-&gt;</text>
                  <text x="408" y="292">ABORT</text>
                  <text x="472" y="292">(Error)</text>
                  <text x="236" y="308">if</text>
                  <text x="268" y="308">peer</text>
                  <text x="296" y="308">&gt;</text>
                  <text x="328" y="308">local</text>
                  <text x="372" y="308">-&gt;</text>
                  <text x="416" y="308">ABANDON</text>
                  <text x="480" y="308">update;</text>
                  <text x="420" y="324">updating</text>
                  <text x="468" y="324">:=</text>
                  <text x="492" y="324">0;</text>
                  <text x="88" y="340">|</text>
                  <text x="160" y="340">|</text>
                  <text x="464" y="340">act</text>
                  <text x="492" y="340">as</text>
                  <text x="544" y="340">RESPONDER</text>
                  <text x="136" y="372">APP</text>
                  <text x="172" y="372">send</text>
                  <text x="232" y="372">(anytime)</text>
                  <text x="400" y="372">(Self-Loop)</text>
                  <text x="96" y="404">APP</text>
                  <text x="136" y="404">recv:</text>
                  <text x="204" y="404">retain_old</text>
                  <text x="260" y="404">&amp;&amp;</text>
                  <text x="280" y="404">e</text>
                  <text x="300" y="404">==</text>
                  <text x="340" y="404">old_rx</text>
                  <text x="432" y="404">(Self-Loop)</text>
                  <text x="56" y="436">APP</text>
                  <text x="96" y="436">recv:</text>
                  <text x="128" y="436">e</text>
                  <text x="148" y="436">==</text>
                  <text x="172" y="436">rx</text>
                  <text x="440" y="436">(Self-Loop)</text>
                  <text x="116" y="468">recv</text>
                  <text x="156" y="468">Resp</text>
                  <text x="188" y="468">[e</text>
                  <text x="212" y="468">==</text>
                  <text x="240" y="468">rx]</text>
                  <text x="124" y="484">derive</text>
                  <text x="188" y="484">secrets;</text>
                  <text x="244" y="484">send</text>
                  <text x="280" y="484">NKU</text>
                  <text x="332" y="484">[tag=old</text>
                  <text x="384" y="484">tx]</text>
                  <text x="60" y="532">WAIT_R_NKU</text>
                  <text x="88" y="580">APP</text>
                  <text x="144" y="580">send/recv</text>
                  <text x="216" y="580">allowed</text>
                  <text x="16" y="612">(6)</text>
                  <text x="52" y="612">recv</text>
                  <text x="88" y="612">NKU</text>
                  <text x="136" y="612">[e==rx]</text>
                  <text x="44" y="628">(Responder</text>
                  <text x="112" y="628">still</text>
                  <text x="156" y="628">tags</text>
                  <text x="192" y="628">old</text>
                  <text x="224" y="628">tx)</text>
                  <text x="56" y="644">v</text>
                  <text x="52" y="676">ACTIVATE</text>
                  <text x="128" y="676">RETENTION</text>
                  <text x="60" y="692">old_rx=rx;</text>
                  <text x="72" y="708">retain_old=1;</text>
                  <text x="40" y="724">rx=rx</text>
                  <text x="76" y="724">1;</text>
                  <text x="120" y="724">tx=tx+1</text>
                  <text x="56" y="756">|</text>
                  <text x="16" y="772">(8)</text>
                  <text x="52" y="772">send</text>
                  <text x="88" y="772">ACK</text>
                  <text x="140" y="772">[tag=tx]</text>
                  <text x="48" y="788">set</text>
                  <text x="100" y="788">updating</text>
                  <text x="148" y="788">:=</text>
                  <text x="172" y="788">0;</text>
                  <text x="212" y="788">assert</text>
                  <text x="268" y="788">tx==rx</text>
                  <text x="56" y="804">v</text>
                  <text x="52" y="836">FINISHED</text>
                  <text x="72" y="852">(retain_old=0</text>
                  <text x="152" y="852">after</text>
                  <text x="200" y="852">first</text>
                  <text x="240" y="852">APP</text>
                  <text x="268" y="852">at</text>
                  <text x="296" y="852">new</text>
                  <text x="328" y="852">rx)</text>
                </g>
              </svg><a href="#appendix-B.4.2-8.1" class="pilcrow">Â¶</a>
</div>
</div>
</section>
</div>
<div id="state-machine-responder">
<section id="appendix-B.4.3">
          <h4 id="name-state-machine-responder">
<a href="#appendix-B.4.3" class="section-number selfRef">B.4.3. </a><a href="#name-state-machine-responder" class="section-name selfRef">State Machine (Responder)</a>
          </h4>
<p id="appendix-B.4.3-1">The responder starts in the START state with synchronized transmit and receive epochs (rx := E; tx := E) and no update in progress. Application data can be transmitted at any time using the sender's current transmit epoch. A receiver must accept application data if the epoch tag on the DTLS record equals the receiver's current receive epoch. If the receiver has retention active (retain_old == true), the receiver must also accept DTLS records whose epoch tag equals the remembered previous epoch.<a href="#appendix-B.4.3-1" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.3-2">Upon receiving an ExtendedKeyUpdate(key_update_request) (Req), the responder transitions to RESPOND. The responder may defer sending key_update_response under load; in that case it must acknowledge the request with an ACK and retransmit the response until it is acknowledged by the initiator, as specified in DTLS considerations. When sent, key_update_response is tagged with the current tx. After sending the response, the responder enters WAIT_I_NKU.<a href="#appendix-B.4.3-2" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.3-3">When a new_key_update (NKU) is received with the correct epoch, the responder activates retention mode: the old epoch is remembered, the receive epoch is incremented, and application data is accepted under both epochs for a transition period. The responder then sends its own NKU tagged with the old transmit epoch and moves to WAIT_ACK.<a href="#appendix-B.4.3-3" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.3-4">Finally, upon receipt of an ACK matching the updated epoch, the responder completes the transition by synchronizing transmit and receive epochs (tx := rx), disabling retention, and clearing the update flag. The state machine returns to FINISHED, ready for subsequent updates.<a href="#appendix-B.4.3-4" class="pilcrow">Â¶</a></p>
<p id="appendix-B.4.3-5">Throughout the process:<a href="#appendix-B.4.3-5" class="pilcrow">Â¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.4.3-6.1">
              <p id="appendix-B.4.3-6.1.1">Duplicate messages are tolerated (for retransmission handling).<a href="#appendix-B.4.3-6.1.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.3-6.2">
              <p id="appendix-B.4.3-6.2.1">Temporary epoch mismatches are permitted while an update is in progress.<a href="#appendix-B.4.3-6.2.1" class="pilcrow">Â¶</a></p>
</li>
            <li class="normal" id="appendix-B.4.3-6.3">
              <p id="appendix-B.4.3-6.3.1">Application data flows continuously, subject to epoch acceptance rules.<a href="#appendix-B.4.3-6.3.1" class="pilcrow">Â¶</a></p>
</li>
          </ul>
<div id="appendix-B.4.3-7">
            <div class="alignLeft art-svg artwork" id="appendix-B.4.3-7.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="704" width="536" viewBox="0 0 536 704" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 8,192" fill="none" stroke="black"></path>
                <path d="M 8,288 L 8,336" fill="none" stroke="black"></path>
                <path d="M 8,400 L 8,464" fill="none" stroke="black"></path>
                <path d="M 8,528 L 8,576" fill="none" stroke="black"></path>
                <path d="M 8,656 L 8,688" fill="none" stroke="black"></path>
                <path d="M 56,200 L 56,280" fill="none" stroke="black"></path>
                <path d="M 104,656 L 104,688" fill="none" stroke="black"></path>
                <path d="M 128,528 L 128,576" fill="none" stroke="black"></path>
                <path d="M 136,288 L 136,304" fill="none" stroke="black"></path>
                <path d="M 184,400 L 184,464" fill="none" stroke="black"></path>
                <path d="M 192,160 L 192,192" fill="none" stroke="black"></path>
                <path d="M 280,32 L 280,80" fill="none" stroke="black"></path>
                <path d="M 8,32 L 280,32" fill="none" stroke="black"></path>
                <path d="M 8,80 L 280,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 192,160" fill="none" stroke="black"></path>
                <path d="M 8,192 L 192,192" fill="none" stroke="black"></path>
                <path d="M 8,288 L 136,288" fill="none" stroke="black"></path>
                <path d="M 8,336 L 136,336" fill="none" stroke="black"></path>
                <path d="M 8,400 L 184,400" fill="none" stroke="black"></path>
                <path d="M 8,464 L 184,464" fill="none" stroke="black"></path>
                <path d="M 8,528 L 128,528" fill="none" stroke="black"></path>
                <path d="M 8,576 L 128,576" fill="none" stroke="black"></path>
                <path d="M 8,656 L 104,656" fill="none" stroke="black"></path>
                <path d="M 8,688 L 104,688" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="64,280 52,274.4 52,285.6" fill="black" transform="rotate(90,56,280)"></polygon>
                <g class="text">
                  <text x="40" y="52">START</text>
                  <text x="28" y="68">rx</text>
                  <text x="52" y="68">:=</text>
                  <text x="76" y="68">E;</text>
                  <text x="100" y="68">tx</text>
                  <text x="124" y="68">:=</text>
                  <text x="148" y="68">E,</text>
                  <text x="196" y="68">updating</text>
                  <text x="244" y="68">:=</text>
                  <text x="264" y="68">0</text>
                  <text x="56" y="100">|</text>
                  <text x="16" y="116">(3)</text>
                  <text x="52" y="116">recv</text>
                  <text x="88" y="116">Req</text>
                  <text x="136" y="116">[e==rx]</text>
                  <text x="48" y="132">set</text>
                  <text x="100" y="132">updating</text>
                  <text x="148" y="132">:=</text>
                  <text x="168" y="132">1</text>
                  <text x="56" y="148">v</text>
                  <text x="48" y="180">RESPOND</text>
                  <text x="84" y="228">send</text>
                  <text x="124" y="228">Resp</text>
                  <text x="180" y="228">[tag=tx]</text>
                  <text x="84" y="244">(may</text>
                  <text x="132" y="244">defer;</text>
                  <text x="172" y="244">if</text>
                  <text x="224" y="244">deferred,</text>
                  <text x="280" y="244">ACK</text>
                  <text x="312" y="244">Req</text>
                  <text x="344" y="244">and</text>
                  <text x="384" y="244">later</text>
                  <text x="452" y="244">retransmit</text>
                  <text x="516" y="244">Resp</text>
                  <text x="96" y="260">until</text>
                  <text x="172" y="260">acknowledged</text>
                  <text x="236" y="260">by</text>
                  <text x="264" y="260">the</text>
                  <text x="324" y="260">initiator)</text>
                  <text x="60" y="308">WAIT_I_NKU</text>
                  <text x="68" y="324">(updating=1)</text>
                  <text x="128" y="324">|</text>
                  <text x="56" y="356">|</text>
                  <text x="16" y="372">(5)</text>
                  <text x="52" y="372">recv</text>
                  <text x="88" y="372">NKU</text>
                  <text x="136" y="372">[e==rx]</text>
                  <text x="240" y="372">(assert</text>
                  <text x="312" y="372">accepted)</text>
                  <text x="56" y="388">v</text>
                  <text x="52" y="420">ACTIVATE</text>
                  <text x="128" y="420">RETENTION</text>
                  <text x="60" y="436">old_rx=rx;</text>
                  <text x="72" y="452">retain_old=1;</text>
                  <text x="148" y="452">rx++</text>
                  <text x="56" y="484">|</text>
                  <text x="16" y="500">(6)</text>
                  <text x="52" y="500">send</text>
                  <text x="88" y="500">NKU</text>
                  <text x="140" y="500">[tag=old</text>
                  <text x="192" y="500">tx]</text>
                  <text x="56" y="516">v</text>
                  <text x="52" y="548">WAIT_ACK</text>
                  <text x="68" y="564">(updating=1)</text>
                  <text x="56" y="596">|</text>
                  <text x="24" y="612">(7/8)</text>
                  <text x="68" y="612">recv</text>
                  <text x="104" y="612">ACK</text>
                  <text x="152" y="612">[e==rx]</text>
                  <text x="60" y="628">tx=rx;</text>
                  <text x="144" y="628">retain_old=0;</text>
                  <text x="236" y="628">updating</text>
                  <text x="284" y="628">:=</text>
                  <text x="304" y="628">0</text>
                  <text x="56" y="644">v</text>
                  <text x="52" y="676">FINISHED</text>
                </g>
              </svg><a href="#appendix-B.4.3-7.1" class="pilcrow">Â¶</a>
</div>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Hannes Tschofenig</span></div>
<div dir="auto" class="left"><span class="org">Siemens</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hannes.tschofenig@gmx.net" class="email">hannes.tschofenig@gmx.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael TÃ¼xen</span></div>
<div dir="auto" class="left"><span class="org">MÃ¼nster Univ. of Applied Sciences</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tuexen@fh-muenster.de" class="email">tuexen@fh-muenster.de</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tirumaleswar Reddy</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:kondtir@gmail.com" class="email">kondtir@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steffen Fries</span></div>
<div dir="auto" class="left"><span class="org">Siemens</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:steffen.fries@siemens.com" class="email">steffen.fries@siemens.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yaroslav Rosomakho</span></div>
<div dir="auto" class="left"><span class="org">Zscaler</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yrosomakho@zscaler.com" class="email">yrosomakho@zscaler.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
